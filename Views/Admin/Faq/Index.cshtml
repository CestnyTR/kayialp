@model IEnumerable<kayialp.Models.Faqs>

@{
    Layout = "/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "SSS Yönetimi";
    var trId = (int)ViewBag.TrId; 

}

<h1 class="h3 mb-3">SSS Yönetimi</h1>

@if (TempData["FaqMsg"] is string msg)
{
    <div class="alert alert-success">@msg</div>
}

<a asp-action="Create" class="btn btn-primary mb-3">Yeni SSS Ekle</a>

<table id="faqTable" class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Sıra</th>
            <th>Soru (TR)</th>
            <th>Cevap (TR)</th>
            <th>İşlemler</th>
        </tr>
    </thead>
    <tbody id="faqSortable">
    @foreach (var item in Model)
    {
        var tr = item.Translations.FirstOrDefault(x => x.LangCodeId == trId);

        <tr data-id="@item.Id">
            <td>@item.Id</td>
            <td>@item.Order</td>
            <td>@tr?.Question</td>
            <td>@tr?.Answer</td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning">Düzenle</a>
                <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display:inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Silmek istediğinize emin misiniz?');">Sil</button>
                </form>
            </td>
        </tr>
    }
    </tbody>
</table>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script>
        new Sortable(document.getElementById("faqSortable"), {
            animation: 150,
            onEnd: function () {
                var order = [];
                $("#faqSortable tr").each(function (index) {
                    order.push({
                        id: $(this).data("id"),
                        order: index + 1
                    });
                });

                $.ajax({
                    url: '/admin/faq/update-order',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(order),
                    success: function () {
                        location.reload();
                    },
                    error: function () {
                        alert("Sıralama güncellenemedi!");
                    }
                });
            }
        });
    </script>
}